let pinner=null;function getBase64Image(e,t){var n=new XMLHttpRequest;n.onload=function(){var e=new FileReader;e.onloadend=function(){t(e.result)},e.readAsDataURL(n.response)},n.open("GET",e),n.responseType="blob",n.send()}function setPostData(e){console.log(e)}function togglePinner({status:e,type:t}){pinner.style.display="on"==e?"block":"none"}function createPostData(){chrome.runtime.sendMessage("getToken",(function(e){const t={data:[]},n={};t.token=e,n.type="html",n.html=selectedElement.outerHTML,n.text=selectedElement.innerText,t.data.push(n),setPostData(t)}))}chrome.runtime.onMessage.addListener((function(e){if(e.pinnerStatus&&togglePinner(e.pinnerStatus),e.target&&"image"==e.target.mediaType)getBase64Image(e.target.srcUrl,(t=>{const n={data:[]},o={};n.token=e.token,o.type="image",o.base64=t,o.url=e.target.srcUrl,n.data.push(o),setPostData(n)}));else if(e.target&&e.target.selectionText){const t={data:[]};console.log(selectedElement);const n={};t.token=e.token,n.type="html",n.html=selectedElement.outerHTML,n.text=selectedElement.innerText,t.data.push(n),setPostData(t)}})),document.onselectionchange=function(e){const t=document.getSelection();if(!t.isCollapsed){selectedElement=document.createElement("div");for(let e=0;e<t.rangeCount;e++)selectedElement.append(t.getRangeAt(e).cloneContents()),t.getRangeAt(e).cloneContents();for(let e=0;e<selectedElement.children.length;e++)selectedElement.children[e].removeAttribute("class")}"wejePinner"==t.anchorNode.id&&createPostData(),t.isCollapsed?(pinner.style.top=0,pinner.style.left=0):(pinner.style.top=t.anchorNode.parentNode.offsetTop-15+"px",pinner.style.left=t.anchorNode.parentNode.offsetLeft-15+"px")},pinner=document.createElement("div"),pinner.classList.add("my-class"),pinner.id="wejePinner",pinner.style="position: absolute;top: 10px;left: 10px;width: 10px;height: 10px;background: brown;z-index: 10000;cursor: pointer; display:none",document.body.append(pinner);