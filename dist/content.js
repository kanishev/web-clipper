let pinner=null,alert=null,selectedElement=null;function getBase64Image(e,t){var n=new XMLHttpRequest;n.onload=function(){var e=new FileReader;e.onloadend=function(){t(e.result)},e.readAsDataURL(n.response)},n.open("GET",e),n.responseType="blob",n.send()}function setPostData(e){console.log(e),alert.style.display="flex",setTimeout((()=>{alert.style.display="none"}),3e3)}function setPinnerCoords(e){e.isCollapsed?(pinner.style.top=0,pinner.style.left=0):(pinner.style.top=e.anchorNode.parentNode.offsetTop-15+"px",pinner.style.left=e.anchorNode.parentNode.offsetLeft-20+"px")}function togglePinner({status:e,type:t}){pinner.style.display="on"==e?"block":"none"}function createPostData(e){chrome.runtime.sendMessage("getToken",(function(t){if("IMG"==e.nodeName)getBase64Image(selectedElement.src,(e=>{const n={data:[]};n.token=t;const o={type:"image"};o.base64=e,o.url=selectedElement.src,n.data.push(o),setPostData(n)}));else{const e={data:[]};e.token=t;const n={type:"image"};n.html=selectedElement.outerHTML,n.text=selectedElement.innerText,e.data.push(n),setPostData(e)}}))}chrome.runtime.onMessage.addListener((function(e){if(e.pinnerStatus&&togglePinner(e.pinnerStatus),e.target&&"image"==e.target.mediaType)getBase64Image(e.target.srcUrl,(t=>{const n={data:[]};n.token=e.token;const o={type:"image"};o.base64=t,o.url=e.target.srcUrl,n.data.push(o),setPostData(n)}));else if(e.target&&e.target.selectionText){const t={data:[]},n={};t.token=e.token,n.type="html",n.html=selectedElement.outerHTML,n.text=selectedElement.innerText,t.data.push(n),setPostData(t)}})),document.onselectionchange=function(){const e=document.getSelection();if(!e.isCollapsed){selectedElement=document.createElement("div");for(let t=0;t<e.rangeCount;t++)selectedElement.append(e.getRangeAt(t).cloneContents()),e.getRangeAt(t).cloneContents();for(let e=0;e<selectedElement.children.length;e++)selectedElement.children[e].removeAttribute("class")}"wejePinner"==e.anchorNode.id&&createPostData(selectedElement),setPinnerCoords(e)},pinner=document.createElement("div"),pinner.classList.add("my-class"),pinner.id="wejePinner",pinner.style="position: absolute;top: 10px;left: 10px;width: 20px;height: 20px;background: blue;border-radius:50%; z-index: 10000;cursor: pointer; display:none",document.body.append(pinner),document.onmousemove=function(e){"IMG"==e.target.nodeName&&(pinner.style.top=e.target.offsetTop+10+"px",pinner.style.left=e.target.offsetLeft+10+"px",selectedElement=e.target)},alert=document.createElement("div"),alert.classList.add("my-alert"),alert.id="wejeAlert",alert.style="display:none;z-index: 100;width: 200px;height: 50px;background: deepskyblue;position: fixed;top: 0;left: 50%;border-bottom-right-radius: 10px;border-bottom-left-radius: 10px; justify-content: center;align-items: center;color: white;",alert.innerText="SENT CONTENT",document.body.append(alert);